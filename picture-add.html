<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="renderer" content="webkit|ie-comp|ie-stand">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
		<meta http-equiv="Cache-Control" content="no-siteapp" />
		<link rel="Bookmark" href="/favicon.ico" >
		<link rel="Shortcut Icon" href="/favicon.ico" />
		<!--[if lt IE 9]>
		<script type="text/javascript" src="static/extension/html5shiv.js"></script>
		<script type="text/javascript" src="static/extension/respond.min.js"></script>
		<![endif]-->
		<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
		<link rel="stylesheet" type="text/css" href="static/extension/Hui-iconfont/1.0.8/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
		<!--[if IE 6]>
		<script type="text/javascript" src="static/extension/DD_belatedPNG_0.0.8a-min.js" ></script>
		<script>DD_belatedPNG.fix('*');</script>
		<![endif]-->
		<link rel="stylesheet" type="text/css" href="static/extension/webuploader/0.1.5/webuploader.css"/>
		<link rel="stylesheet" type="text/css" href="static/extension/kindeditor/themes/default/default.css"/>
		<style>
			.fl{
				float: left;
				margin-top: -2px;
			}
			/**/
			.title{
				padding: 10px 0;
				text-indent: 20px;
			}
			.input-text2wrap{
				margin-left: 120px;
				padding: 0px 15px;
				border: 1px solid #ccc;
				min-height: 20px;
			}
			.input-text2{
				border: 0;
				padding: 10px 0;
				width: 100%;
			}
			.noBorderPadding{
				border: 0;
				padding: 0;
			}
			.filewrap{
				min-height: 40px;
				padding-bottom:10px ;
			}
			.submitbutton{
				border: 0;
				padding: 10px 30px;
				color: white;
				background-color: #009900;
			}
			.sub2{
				background-color: #A3C6C8;
			}
		</style>
		<title></title>
	</head>
	<body>
		<div>
			<div style="padding: 30px 50px 20px 30px;max-width: 1200px;margin: auto;">
				<div style="padding-bottom: 10px;">
					<span class="fl title">标题：</span>
					<p class="input-text2wrap">
						<input type="text" class="input-text2 Wdate" name="" onfocus="WdatePicker({ maxDate:'#F{$dp.$D(\'logmax\')||\'%y-%M-%d\'}' })" id="logmin">
					</p>					
				</div>				
				<div style="padding-bottom: 10px;margin-top: -10px;">
					<span class="fl title">标题：</span>
					<p class="input-text2wrap">
						<input type="text" class="input-text2 Wdate" name="" onfocus="WdatePicker({ minDate:'#F{$dp.$D(\'logmin\')}',maxDate:'%y-%M-%d' })" id="logmax">
					</p>					
				</div>				
				<div style="padding-bottom: 10px;margin-top: -10px;">
					<span class="fl title">标题：</span>
					<p class="input-text2wrap">
						<input type="text" class="input-text2" id="" name="">
					</p>					
				</div>				
				<div style="padding-bottom: 10px;margin-top: -10px;">
					<span class="fl title">标题：</span>
					<p class="input-text2wrap">
						<input type="text" class="input-text2" id="" name="">
					</p>					
				</div>				
				<div style="padding-bottom: 10px;margin-top: -10px;">
					<span class="fl title">标题：</span>
					<p class="input-text2wrap">
						<input type="text" class="input-text2" id="" name="">
					</p>					
				</div>				
				<div style="padding-bottom: 10px;margin-top: -10px;">
					<span class="fl title">标题：</span>
					<div class="input-text2wrap noBorderPadding filewrap">
						<!--<div id="uploader" class="wu-example" 用来存放文件信息>
						    <div id="thelist" class="uploader-list"></div>
						    <div class="btns">
						        <div id="picker">选择文件</div>
						        <button id="ctlBtn" class="btn btn-default">开始上传</button>
						    </div>
						</div>-->
						<div id="fileList" class="uploader-list"></div>
    					<div id="filePicker">选择图片</div>
    					<button id="btn-star" class="btn btn-default btn-uploadstar radius ml-10">开始上传</button>
					</div>					
				</div>				
				<div style="padding-bottom: 10px;margin-top: -10px;">
					<span class="fl title">标题：</span>
					<p class="input-text2wrap noBorderPadding">
						<textarea name="content" style="min-width: 680px;resize: none;">Next, use our Get Started docs to setup Tiny!</textarea>
					</p>					
				</div>				
				<div style="padding-bottom: 10px;margin-top: -10px;">
					<span class="fl title"></span>
					<p class="input-text2wrap noBorderPadding">
						<button class="submitbutton">提交</button>
						<button class="submitbutton sub2" onclick="_wm.thisWinClose()">取消</button>
					</p>					
				</div>				
			</div>
		</div>
		<!--_footer 作为公共模版分离出去-->
		<script type="text/javascript" src="static/extension/jquery/1.9.1/jquery.min.js"></script>
		<script type="text/javascript" src="static/extension/layer/2.4/layer.js"></script>
		<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script>
		<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script> <!--/_footer 作为公共模版分离出去-->
		<script type="text/javascript" src="static/extension/My97DatePicker/4.8/WdatePicker.js"></script>
		<script src="static/extension/webuploader/0.1.5/webuploader.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="static/extension/kindeditor/kindeditor.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="static/extension/kindeditor/lang/zh_CN.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			//data
			var _wd = {
				//upload相关
				uploader:null,
				$list :null,
				$btn : null,
				state :null,
				ratio :null,
				//富文本域
				
			}
			//methods
			var _wm = {
				thisWinClose:function(){		
//					window.parent.location.reload();
					var index = parent.layer.getFrameIndex(window.name);
					parent.layer.close(index);
				},
				webuploaderInit_file:function(){
					//初始化
					_wd.$list = $("#thelist"),
					_wd.$btn = $("#ctlBtn"),
					_wd.state = "pending",
					_wd.uploader = WebUploader.create({					
					    // swf文件路径
					    swf: '/static/extension/webuploader/0.1.5//Uploader.swf',					
					    // 文件接收服务端。
					    server: 'http://webuploader.duapp.com/server/fileupload.php',					
					    // 选择文件的按钮。可选。
					    // 内部根据当前运行是创建，可能是input元素，也可能是flash.
					    pick: '#picker',					
					    // 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！
					    resize: false
					});
					// 当有文件被添加进队列的时候
					_wd.uploader.on( 'fileQueued', function( file ) {
					    _wd.$list.append( '<div id="' + file.id + '" class="item">' +
					        '<h4 class="info">' + file.name + '</h4>' +
					        '<p class="state">等待上传...</p>' +
					    '</div>' );
					});
					// 文件上传过程中创建进度条实时显示。
					_wd.uploader.on( 'uploadProgress', function( file, percentage ) {
					    var $li = $( '#'+file.id ),
					        $percent = $li.find('.progress .progress-bar');
					
					    // 避免重复创建
					    if ( !$percent.length ) {
					        $percent = $('<div class="progress progress-striped active">' +
					          '<div class="progress-bar" role="progressbar" style="width: 0%">' +
					          '</div>' +
					        '</div>').appendTo( $li ).find('.progress-bar');
					    }
					
					    $li.find('p.state').text('上传中');
					
					    $percent.css( 'width', percentage * 100 + '%' );
					});
					//处理成功或者失败
					_wd.uploader.on( 'uploadSuccess', function( file ) {
					    $( '#'+file.id ).find('p.state').text('已上传');
					});
					
					_wd.uploader.on( 'uploadError', function( file ) {
					    $( '#'+file.id ).find('p.state').text('上传出错');
					});
					
					_wd.uploader.on( 'uploadComplete', function( file ) {
					    $( '#'+file.id ).find('.progress').fadeOut();
					});
					_wd.uploader.on( 'all', function( type ) {
				        if ( type === 'startUpload' ) {
				            _wd.state = 'uploading';
				        } else if ( type === 'stopUpload' ) {
				            _wd.state = 'paused';
				        } else if ( type === 'uploadFinished' ) {
				            _wd.state = 'done';
				        }
				
				        if ( _wd.state === 'uploading' ) {
				            $btn.text('暂停上传');
				        } else {
				            $btn.text('开始上传');
				        }
				    });
					_wd.$btn.on( 'click', function() {
				        if ( _wd.state === 'uploading' ) {
				            _wd.uploader.stop();
				        } else {
				            _wd.uploader.upload();
				        }
				    });
				},
				webuploaderInit_image:function(){
					// 初始化Web Uploader
					
					_wd.$list = $("#fileList"),
					/**
					 * 优化retina, 在retina下这个值是2
					 */
					_wd.ratio = window.devicePixelRatio || 1,
					_wd.uploader = WebUploader.create({
					
					    // 选完文件后，是否自动上传。
					    auto: true,
					
					    // swf文件路径
					    swf: '/static/extension/webuploader/0.1.5//Uploader.swf',
					
					    // 文件接收服务端。
					    server: 'http://webuploader.duapp.com/server/fileupload.php',
					
					    // 选择文件的按钮。可选。
					    // 内部根据当前运行是创建，可能是input元素，也可能是flash.
					    pick: '#filePicker',
					
					    // 只允许选择图片文件。
					    accept: {
					        title: 'Images',
					        extensions: 'gif,jpg,jpeg,bmp,png',
					        mimeTypes: 'image/*'
					    }
					});
					// 当有文件添加进来的时候
					_wd.uploader.on( 'fileQueued', function( file ) {
					    var $li = $(
					            '<div id="' + file.id + '" class="file-item thumbnail">' +
					                '<img>' +
					                '<div class="info">' + file.name + '</div>' +
					            '</div>'
					            ),
					        $img = $li.find('img');
					
					
					    // $list为容器jQuery实例
					    _wd.$list.append( $li );
					
					    // 创建缩略图
					    // 如果为非图片文件，可以不用调用此方法。
					    // thumbnailWidth x thumbnailHeight 为 100 x 100
					    _wd.uploader.makeThumb( file, function( error, src ) {
					        if ( error ) {
					            $img.replaceWith('<span>不能预览</span>');
					            return;
					        }
					
					        $img.attr( 'src', src );
//					    }, thumbnailWidth, thumbnailHeight );
					    }, 100, 100 );
					});
					// 文件上传过程中创建进度条实时显示。
					_wd.uploader.on( 'uploadProgress', function( file, percentage ) {
					    var $li = $( '#'+file.id ),
					        $percent = $li.find('.progress span');
					
					    // 避免重复创建
					    if ( !$percent.length ) {
					        $percent = $('<p class="progress"><span></span></p>')
					                .appendTo( $li )
					                .find('span');
					    }
					
					    $percent.css( 'width', percentage * 100 + '%' );
					});
					
					// 文件上传成功，给item添加成功class, 用样式标记上传成功。
					_wd.uploader.on( 'uploadSuccess', function( file ) {
					    $( '#'+file.id ).addClass('upload-state-done');
					});
					
					// 文件上传失败，显示上传出错。
					_wd.uploader.on( 'uploadError', function( file ) {
					    var $li = $( '#'+file.id ),
					        $error = $li.find('div.error');
					
					    // 避免重复创建
					    if ( !$error.length ) {
					        $error = $('<div class="error"></div>').appendTo( $li );
					    }
					
					    $error.text('上传失败');
					});
					
					// 完成上传完了，成功或者失败，先删除进度条。
					_wd.uploader.on( 'uploadComplete', function( file ) {
					    $( '#'+file.id ).find('.progress').remove();
					});
				}
			}
			//mounted
			function mounted(){
				//
//				_wm.webuploaderInit_file()
				_wm.webuploaderInit_image()
				//
				KindEditor.create('textarea[name="content"]');
			};mounted()
		</script>
	</body>
</html>